<!DOCTYPE html>
<html lang="en">

<!-- Head tag -->
<head><meta name="generator" content="Hexo 3.9.0">

    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <link rel="shortcut icon" href="/img/favicon.ico">

    <!--Description-->
    
        <meta name="description" content="èƒŒæ™¯åœ¨åœ°å›¾ä¸ŠæŸåŸå¸‚æ·»åŠ å¤šä¸ªå®è—ï¼Œç„¶åæ ¹æ®ç”¨æˆ· GPS ä¿¡æ¯è·å–å½“å‰ä½ç½®åœ¨åœ°å›¾åœ¨å¯»æ‰¾å®è—ã€‚å½“ç”¨æˆ·ä½ç½®åˆ°è¾¾å®è—ä½ç½®å°±æ‰“å¼€å®è—ã€‚
ç›®æ ‡/æŠ€æœ¯ç‚¹
åœ¨ web é¡µé¢ä¸­å®ç°å®šä½
å½“ç”¨æˆ·ç§»åŠ¨ä½ç½®åˆ·æ–°å½“å‰ä½ç½®
æ ¹æ® ç»çº¬åº¦è®¡ç®—åœ°çƒä¸Šä¸¤ç‚¹è·ç¦»


é€šè¿‡ç™¾åº¦åœ°å›¾ API æ˜¾ç¤ºåœ°å›¾
é€šè¿‡ç™¾åº¦åœ°å›¾ API å®šæ—¶åˆ·æ–°ï¼ˆæœ‰é—®é¢˜">
    

    <!--Author-->
    
        <meta name="author" content="Citrus">
    

    <!--Open Graph Title-->
    
        <meta property="og:title" content="Web åœ°å›¾ GPS å®šä½">
    

    <!--Open Graph Description-->
    

    <!--Open Graph Site Name-->
    <meta property="og:site_name" content="Blog 1">

    <!--Type page-->
    
        <meta property="og:type" content="article">
    

    <!--Page Cover-->
    

    <meta name="twitter:card" content="summary">
    

    <!-- Title -->
    
    <title>Web åœ°å›¾ GPS å®šä½ - Blog 1</title>

    <!-- Tachyons Core CSS -->
    <!-- <link rel="stylesheet" href="//unpkg.com/tachyons/css/tachyons.min.css"> -->
    <link rel="stylesheet" href="/blog/css/tachyons.css">
    <link rel="stylesheet" href="/blog/css/font-awesome.css">

    <!-- HTML5 Shim and Respond.js IE8 support of HTML5 elements and media queries -->
    <!-- WARNING: Respond.js doesn't work if you view the page via file:// -->
    <!--[if lt IE 9]>
        <script src="//oss.maxcdn.com/libs/html5shiv/3.7.0/html5shiv.js"></script>
        <script src="//oss.maxcdn.com/libs/respond.js/1.4.2/respond.min.js"></script>
    <![endif]-->

    <!-- Custom CSS -->
    <link rel="stylesheet" href="/blog/css/style.css">

    <!-- Google Analytics -->
    


</head>


<body>

<!-- Main Content -->
<!-- Banner -->
<!-- Banner -->
<div class="w-100 bg-1 ph5-ns ph3 text-light">
    
    <nav class="db dt-l w-100 mw8 center border-box pv3">
        
        <div class="db dtc-l v-mid w-100 w-75-l tc tr-l">
            
                <a class="link dim f6 f5-l dib mr3 mr4-l white" 
                    href="/blog/" 
                    title="Home">
                    Home
                </a>
            
                <a class="link dim f6 f5-l dib mr3 mr4-l white" 
                    href="/blog/archives" 
                    title="Archives">
                    Archives
                </a>
            
                <a class="link dim f6 f5-l dib mr3 mr4-l white" 
                    href="/blog/about" 
                    title="About">
                    About
                </a>
            
        </div>
    </nav>

    <!-- Title -->
    <div class="w-100 mw8 center vh-40 dt">
        <div class="dtc v-mid white">
            <h1 class="f1-l f2-m tc tc-m tl-ns">Web åœ°å›¾ GPS å®šä½</h1>
            <p class="f4 fw3 pab-100px tc tc-m tl-ns">2017-09-08</p>
        </div>
    </div>

    <!-- Icon -->
    <div class="relative w-100 mw8 center white dn dn-m db-ns">
        <i class="header-icon fa fa-location-arrow"></i>
    </div>
</div>

<!-- Content -->
<div class="w-100 ph2 ph4-m ph5-l mv5 mv6-l">
    <div class="content">
        <div class="mw8 center">
            <div class="cf">
                <div class="w-100 center lh-copy pr4-ns pr0-m post-content">
                    <!-- Tags Vertical -->
                    
                        <div class="tags-container-vertical">
                            <div class="tags-sub-container">
                                <a class="fw3 ph1 dib" href="/blog/tags/Map/">#Map</a> <a class="fw3 ph1 dib" href="/blog/tags/ç™¾åº¦åœ°å›¾/">#ç™¾åº¦åœ°å›¾</a> <a class="fw3 ph1 dib" href="/blog/tags/getCurrentPosition/">#getCurrentPosition</a>
                            </div>
                        </div>
                    

                    <!-- Main Post Content -->
                    <h2 id="èƒŒæ™¯"><a href="#èƒŒæ™¯" class="headerlink" title="èƒŒæ™¯"></a>èƒŒæ™¯</h2><p>åœ¨åœ°å›¾ä¸ŠæŸåŸå¸‚æ·»åŠ å¤šä¸ªå®è—ï¼Œç„¶åæ ¹æ®ç”¨æˆ· GPS ä¿¡æ¯è·å–å½“å‰ä½ç½®åœ¨åœ°å›¾åœ¨å¯»æ‰¾å®è—ã€‚å½“ç”¨æˆ·ä½ç½®åˆ°è¾¾å®è—ä½ç½®å°±æ‰“å¼€å®è—ã€‚</p>
<h2 id="ç›®æ ‡-æŠ€æœ¯ç‚¹"><a href="#ç›®æ ‡-æŠ€æœ¯ç‚¹" class="headerlink" title="ç›®æ ‡/æŠ€æœ¯ç‚¹"></a>ç›®æ ‡/æŠ€æœ¯ç‚¹</h2><ul>
<li>åœ¨ web é¡µé¢ä¸­å®ç°å®šä½</li>
<li>å½“ç”¨æˆ·ç§»åŠ¨ä½ç½®åˆ·æ–°å½“å‰ä½ç½®</li>
<li>æ ¹æ® ç»çº¬åº¦è®¡ç®—åœ°çƒä¸Šä¸¤ç‚¹è·ç¦»</li>
</ul>
<ul>
<li>é€šè¿‡ç™¾åº¦åœ°å›¾ API æ˜¾ç¤ºåœ°å›¾</li>
<li>é€šè¿‡ç™¾åº¦åœ°å›¾ API å®šæ—¶åˆ·æ–°ï¼ˆæœ‰é—®é¢˜ï¼‰</li>
</ul>
<h2 id="é—®é¢˜åŠè¿‡ç¨‹"><a href="#é—®é¢˜åŠè¿‡ç¨‹" class="headerlink" title="é—®é¢˜åŠè¿‡ç¨‹"></a>é—®é¢˜åŠè¿‡ç¨‹</h2><h3 id="ç™¾åº¦å®šä½"><a href="#ç™¾åº¦å®šä½" class="headerlink" title="ç™¾åº¦å®šä½"></a>ç™¾åº¦å®šä½</h3><p>åœ¨ä½¿ç”¨ç™¾åº¦åœ°å›¾çš„ <code>geolocation.getCurrentPosition</code> æ¥å£å‘ç°ç§»åŠ¨ä½ç½®å¹¶æ²¡æœ‰æ›´æ–°å½“å‰ä½ç½®ã€‚æŸ¥æ‰¾èµ„æ–™è¯´è¦è®¾ç½® <code>maximumAge</code>, å®é™…ä¸ŠæŠŠè¿™ä¸ªå€¼è®¾ç½® 0 ä¹Ÿæ²¡å•¥ç”¨ï¼Œç…§æ ·ä¸æ›´æ–°ä½ç½®ã€‚</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">geolocation.getCurrentPosition(<span class="function"><span class="keyword">function</span> (<span class="params">r</span>) </span>&#123;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">if</span> (<span class="keyword">this</span>.getStatus() == BMAP_STATUS_SUCCESS) &#123;</span><br><span class="line">        <span class="keyword">var</span> lng = r.point.lng;</span><br><span class="line">        <span class="keyword">var</span> lat = r.point.lat;</span><br><span class="line">        <span class="built_in">console</span>.log(<span class="string">'æ‚¨çš„ä½ç½®baiduï¼š'</span> + lng + <span class="string">','</span> + lat + <span class="string">',æ—¶é—´ï¼š'</span> + <span class="keyword">new</span> <span class="built_in">Date</span>().getMinutes() + <span class="string">':'</span> + <span class="keyword">new</span> <span class="built_in">Date</span>().getSeconds());</span><br><span class="line">    &#125;<span class="keyword">else</span> &#123;</span><br><span class="line">        <span class="built_in">console</span>.log(<span class="string">'failed'</span> + <span class="keyword">this</span>.getStatus());</span><br><span class="line">    &#125;</span><br><span class="line">&#125;, &#123;</span><br><span class="line">    enableHighAccuracy: <span class="literal">true</span>,</span><br><span class="line">    maximumAge: <span class="number">0</span></span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>
<p>ç»è¿‡å¤šæ¬¡æµ‹è¯•çŒœæµ‹ç™¾åº¦åœ°å›¾ç¼“å­˜äº†å½“å‰ä½ç½®ï¼Œå¤§æ¦‚éœ€è¦10åˆ†é’Ÿæ‰ä¼šæ›´æ–°æ–°çš„ä½ç½®ã€‚æ”¾å¼ƒä¹‹ï¼Œä¸‹ä¸€ä¸ªã€‚</p>
<h3 id="ä½¿ç”¨åŸç”Ÿæ¥å£"><a href="#ä½¿ç”¨åŸç”Ÿæ¥å£" class="headerlink" title="ä½¿ç”¨åŸç”Ÿæ¥å£"></a>ä½¿ç”¨åŸç”Ÿæ¥å£</h3><p>ä½¿ç”¨åŸç”Ÿæ¥å£<code>navigator.geolocation.getCurrentPosition</code></p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span> (navigator.geolocation) &#123;</span><br><span class="line">    navigator.geolocation.getCurrentPosition(<span class="function"><span class="keyword">function</span>(<span class="params">p</span>)</span>&#123;</span><br><span class="line">        <span class="comment">//æˆåŠŸè·å–ä½ç½®</span></span><br><span class="line">        <span class="keyword">var</span> position = &#123;</span><br><span class="line">            lng: p.coords.longitude,</span><br><span class="line">            lat: p.coords.latitude</span><br><span class="line">        &#125;;</span><br><span class="line">      	<span class="built_in">console</span>.log(position);</span><br><span class="line">    &#125;, <span class="function"><span class="keyword">function</span>(<span class="params">err</span>)</span>&#123;</span><br><span class="line">        <span class="built_in">console</span>.log(err);</span><br><span class="line">    &#125;);</span><br><span class="line">&#125;<span class="keyword">else</span> &#123;</span><br><span class="line">    <span class="built_in">console</span>.log( <span class="string">"Geolocation is not supported by this browser."</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>å‡ ä¹å¿«è¦æå®šäº†ï¼Œé€šè¿‡å®šæ—¶è°ƒç”¨å½“å‰ä½ç½®å†è½¬æ¢æˆç™¾åº¦çš„ä½ç½®æ˜¾ç¤ºæ ‡è®°åˆ°åœ°å›¾ä¸Šï¼Œå®Œç¾ï¼âœŒï¸BUT ! å®‰å“ä¸€åˆ‡ OKï¼ŒIOS ä»10å¼€å§‹éœ€è¦ <code>https</code>åè®®æ‰èƒ½ä½¿ç”¨ <code>geolocation</code>ã€‚å¦åˆ™æŠ¥ <code>[blocked] Access to geolocation was blocked over insecure connection to [http://www.mydomain.cn](http://www.mydomain.cn/)</code> é”™ WTFğŸ¤·â€â™‚ï¸ã€‚ </p>
<p>è¿™æ—¶å€™ï¼Œä½ å¯ä»¥é€‰æ‹©</p>
<ul>
<li>æŠŠç½‘ç«™åˆ‡æ¢æˆ <code>https</code> ï¼Œä¸‹é¢å°±ä¸ç”¨çœ‹å•¦ã€‚</li>
<li>ä½¿ç”¨ <code>iframe</code> ã€‚å¦‚æœä½ æš‚æ—¶ä¸èƒ½æ¢æˆ <code>https</code>é‚£å¯ä»¥è¯•è¯•ä»¥ä¸‹æ–¹æ³•</li>
</ul>
<h3 id="ä½¿ç”¨-iframe"><a href="#ä½¿ç”¨-iframe" class="headerlink" title="ä½¿ç”¨ iframe"></a>ä½¿ç”¨ <code>iframe</code></h3><p>æˆ‘çš„æ€è·¯æ˜¯ä½¿ç”¨ <code>iframe</code>åŠ è½½ä¸€ä¸ª<code>https</code>çš„é¡µé¢ï¼Œç„¶åè¿™ä¸ª <code>iframe</code>ä½¿ç”¨  <code>geolocation</code>è¿”å›ä½ç½®ä¿¡æ¯ã€‚è¯´èµ·å¹²å°±å¹²ã€‚åœ¨è¿™é‡Œå¾ˆå®¹æ˜“ç¢°åˆ°å¦ä¸€ä¸ªé—®é¢˜ï¼Œæ²¡é”™ï¼Œæˆ‘å°±ç¢°åˆ°äº†ã€‚ğŸ˜‚ æˆ‘æ˜¯å€ŸåŠ© <code>coding.net</code>çš„ <code>Pages</code>æœåŠ¡åˆ›å»ºäº†ä¸€ä¸ªé¡µé¢ï¼Œä¸ºå˜›ä¸ç”¨<code>github</code>å‘¢ï¼Œå¾ˆç®€å•ï¼Œ<code>coding</code>å¯ä»¥å¾ˆæ–¹ä¾¿ä¸€é”®åˆ‡æ¢æˆ<code>https</code>åè®®ï¼Œè€Œä¸”åœ¨å¤©æœé€Ÿåº¦ sousou çš„ã€‚ç”±äºç”¨äº†ä¸‰æ–¹é¡µé¢åŠ è½½ <code>iframe</code>å°±éš¾å…ç¢°åˆ°è·¨åŸŸé—®é¢˜ã€‚è¿™é‡Œæ¨è <a href="https://github.com/hstarorg/HstarDoc/blob/master/å‰ç«¯ç›¸å…³/Iframeè·¨åŸŸé€šä¿¡çš„å‡ ç§æ–¹å¼.md" target="_blank" rel="noopener">Iframeè·¨åŸŸé€šä¿¡çš„å‡ ç§æ–¹å¼</a></p>
<p>æœ€åä½¿ç”¨ <code>postMessage</code>è§£å†³è·¨åŸŸé—®é¢˜ã€‚ğŸ¤£ æ¥å£è¯¦æƒ…å‚è€ƒ <a href="https://developer.mozilla.org/zh-CN/docs/Web/API/Window/postMessage" target="_blank" rel="noopener">postMessage</a> ã€‚</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// frame</span></span><br><span class="line"><span class="keyword">if</span> (navigator.geolocation) &#123;</span><br><span class="line">  navigator.geolocation.getCurrentPosition(<span class="function"><span class="keyword">function</span>(<span class="params">p</span>)</span>&#123;</span><br><span class="line">    <span class="comment">//æˆåŠŸè·å–ä½ç½®</span></span><br><span class="line">    <span class="keyword">var</span> position = &#123;</span><br><span class="line">      lng: p.coords.longitude,</span><br><span class="line">      lat: p.coords.latitude</span><br><span class="line">    &#125;;</span><br><span class="line">    <span class="built_in">console</span>.log(position);</span><br><span class="line">    parent.postMessage(position, <span class="string">'*'</span>);</span><br><span class="line">  &#125;, <span class="function"><span class="keyword">function</span>(<span class="params">err</span>)</span>&#123;</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">'GPSerr'</span>+err)</span><br><span class="line">  &#125;);</span><br><span class="line">&#125;<span class="keyword">else</span> &#123;</span><br><span class="line">  alert( <span class="string">"OMG ! æ‚¨çš„è®¾å¤‡ä¸æ”¯æŒ GPS"</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">// parent</span><br><span class="line"><span class="tag">&lt;<span class="name">iframe</span> <span class="attr">id</span>=<span class="string">"gpsIframe"</span> <span class="attr">src</span>=<span class="string">"yourwebsite"</span> <span class="attr">style</span>=<span class="string">"display: none"</span>&gt;</span><span class="tag">&lt;/<span class="name">iframe</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">script</span>&gt;</span></span><br><span class="line"><span class="javascript">  <span class="built_in">window</span>.addEventListener(<span class="string">'message'</span>, <span class="function"><span class="keyword">function</span>(<span class="params">evt</span>)</span>&#123;</span></span><br><span class="line"><span class="javascript">    <span class="keyword">if</span> (event.origin !== <span class="string">"yourwebsit"</span>) <span class="keyword">return</span>;</span></span><br><span class="line"><span class="javascript">      <span class="built_in">console</span>.log(evt.data);</span></span><br><span class="line">  &#125;);</span><br><span class="line"><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br></pre></td></tr></table></figure>
<blockquote>
<p>æ‰€æœ‰æºç å·²æ”¾ github <a href="https://github.com/Citrusu/gps" target="_blank" rel="noopener">ç‚¹æˆ‘</a></p>
</blockquote>

                    
                    <!-- Tags Bottom -->
                    
                        <div class="tags-container-bottom">
                            <i class="fa fa-tag pr3 text-main-color"></i><a class="fw3 ph1 dib" href="/blog/tags/Map/">#Map</a> <a class="fw3 ph1 dib" href="/blog/tags/ç™¾åº¦åœ°å›¾/">#ç™¾åº¦åœ°å›¾</a> <a class="fw3 ph1 dib" href="/blog/tags/getCurrentPosition/">#getCurrentPosition</a>
                        </div>
                    

                    <!-- Comments -->
                    
<div id="disqus_thread" class="mt5">
    <div id="commentBtn" class="comment-btn">Comments</div>
    <noscript>Please enable JavaScript to view the <a href="//disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
</div>
<!-- Disqus Comments -->

    <script type="text/javascript">
        // ç‚¹å‡»,å»¶è¿ŸåŠ è½½è¯„è®º
        var commentBtn = document.querySelector('#commentBtn');
        commentBtn.addEventListener('click', function(){
            loadComments();
        });
        
        setTimeout(loadComments, 10000);

        function loadComments(){
            if(commentBtn) {
                commentBtn.style.display = 'node';
                commentBtn = null;

                var disqus_shortname = 'hicitrus-com';
                var dsq = document.createElement('script');
                dsq.type = 'text/javascript';
                dsq.async = true;
                dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
                (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
            };
        }
        
    </script>
    
    



                </div>
                <div class="fl w-100 w-30-l center fw3 lh-copy pl4-ns tl black-50" style="display:none;">
                    
                    <hr class="dn-l mw4 black-50 mt5" />
                    
                    <!-- Widget 1: About -->
                    <div class="mt5 mt0-l">
    <article class="dt db-l mw8 mw8-m mw5-ns center ml0-l bg-white mv3">
        <div class="dn dtc-m db-l v-mid tc pr4 pr0-l" style="min-width: 6rem;">
            <img src="/blog/img/avatar-adm1.jpg" class="mb4-l br-100 h3 w3 h4-l w4-l dib" title="Citrus">
        </div>
        <div class="dtc db-l v-mid lh-copy measure center f6 black-50 tj">
            My name is Citrus Zhou
        </div>
    </article>
</div>

                    <hr class="dn-l mw4 black-50 mt5" />
                    
                    <!-- Widget 2: Categories -->
                    

                    <!-- Widget 3: Recent Posts -->
                    <div class="mt5 tc tl-l">
    <h3>Recent Posts</h3>
    
        <p>
            <a href="/blog/create-git-repo/">æ­å»ºgitä»“åº“</a>
        </p>
    
        <p>
            <a href="/blog/learn-threejs/">å…¨æ™¯å­¦ä¹ </a>
        </p>
    
        <p>
            <a href="/blog/map/">Web åœ°å›¾ GPS å®šä½</a>
        </p>
    
        <p>
            <a href="/blog/use-expect/">ä½¿ç”¨ expect</a>
        </p>
    
        <p>
            <a href="/blog/recognition-QRcode/">ä¸ºä»€ä¹ˆå¾®ä¿¡äºŒç»´ç ä¸èƒ½è¯†åˆ«ï¼Ÿ</a>
        </p>
    
</div>
                </div>
            </div>
        </div>
    </div>
</div>


<!-- Footer -->
<!--  partial('_partial/footer')  -->

<!-- CNZZ analytics -->

<div style="display: none;">
    <script src="https://s95.cnzz.com/z_stat.php?id=1261149292&web_id=1261149292"></script>
</div>


</body>

</html>